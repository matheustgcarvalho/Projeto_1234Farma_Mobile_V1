<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1234Farma - Meus Favoritos</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root { 
            --tech-purple: #2E1A47;
            --neon-mint: #00D284;
            --page-bg: #FFFFFF;       
            --element-bg: #E9ECEF;    
            --card-shadow: 0 4px 10px rgba(0,0,0,0.04);
            --warning-red: #ff4757; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; user-select: none; }
        *::-webkit-scrollbar { display: none; }
        
        body { background-color: var(--page-bg); color: var(--tech-purple); padding-bottom: 90px; overflow-x: hidden; }

        /* === HEADER FIXO === */
        .header-wrapper {
            position: fixed; top: 0; left: 0; width: 100%;
            background: white; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        header { padding: 40px 15px 15px 15px; display: flex; justify-content: center; align-items: center; position: relative; background: white; }
        .brand-logo { font-size: 1.3rem; font-weight: 900; letter-spacing: -1px; }
        .brand-1234 { color: var(--neon-mint); }
        .header-icon-right { position: absolute; right: 15px; top: 45px; color: var(--tech-purple); cursor: pointer; }
        .cart-badge { position: absolute; top: -5px; right: -8px; background-color: var(--warning-red); color: white; font-size: 0.6rem; padding: 2px 5px; border-radius: 10px; border: 2px solid white; font-weight: bold; }

        .search-bar-wrapper { padding: 15px; background: white; }
        .search-input { width: 100%; padding: 8px 35px; border-radius: 20px; background-color: var(--element-bg); font-size: 0.9rem; height: 38px; display: flex; align-items: center; position: relative; }
        .search-icon-span { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 1.1rem; opacity: 0.5; }
        .search-input input { background: none; border: none; width: 100%; outline: none; color: var(--tech-purple); }

        main { padding: 160px 15px 20px 15px; }
        .page-title { font-size: 1rem; font-weight: 800; margin-bottom: 15px; border-left: 3px solid var(--neon-mint); padding-left: 8px; }

        /* === GRID FAVORITOS === */
        .fav-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .product-card { background-color: var(--element-bg); border-radius: 16px; overflow: hidden; display: flex; flex-direction: column; position: relative; box-shadow: var(--card-shadow); padding-bottom: 10px; border: 1px solid #e0e0e0; }
        .btn-fav-toggle { position: absolute; top: 8px; left: 8px; z-index: 5; color: var(--warning-red); cursor: pointer; font-size: 1.1rem; background: none; border: none; }
        .product-img-container { width: 100%; height: 110px; background: white; display: flex; justify-content: center; align-items: center; }
        .product-img { width: 80%; height: 80%; object-fit: contain; mix-blend-mode: multiply; }
        .product-info-wrapper { padding: 8px 10px 0 10px; }
        .product-title { font-size: 0.85rem; font-weight: 700; color: var(--tech-purple); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product-lab-info { font-size: 0.65rem; color: #888; margin-bottom: 2px; }
        .price-container { display: flex; flex-direction: column; margin-top: 2px; }
        .price-old { font-size: 0.6rem; color: #999; text-decoration: line-through; }
        .product-price { font-size: 0.95rem; font-weight: 800; color: var(--tech-purple); }
        .btn-add { width: 28px; height: 28px; border-radius: 50%; border: none; background: var(--neon-mint); color: white; position: absolute; bottom: 8px; right: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
        .btn-add.added { background: var(--tech-purple); transform: scale(1.1); }

        /* === STATES (EMPTY / NOT LOGGED) === */
        .status-container { text-align: center; padding: 60px 20px; display: none; flex-direction: column; align-items: center; }
        .status-container .material-icons { font-size: 4.5rem; color: #DDD; margin-bottom: 20px; }
        .status-container h3 { font-size: 1.1rem; font-weight: 800; margin-bottom: 10px; color: var(--tech-purple); }
        .status-container p { color: #888; font-size: 0.9rem; line-height: 1.4; margin-bottom: 25px; }
        .btn-action { display: inline-block; padding: 14px 30px; background: var(--tech-purple); color: var(--neon-mint); text-decoration: none; border-radius: 15px; font-weight: 800; font-size: 0.85rem; text-transform: uppercase; border: none; cursor: pointer; }

        /* === MODAL DE LOGIN (BOTTOM SHEET) === */
        .login-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000;
            display: none; align-items: flex-end;
            backdrop-filter: blur(2px);
        }
        .login-modal-overlay.active { display: flex; }
        .login-modal-content {
            width: 100%; background: white;
            border-top-left-radius: 30px; border-top-right-radius: 30px;
            padding: 20px 25px 40px 25px;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            max-height: 90vh; overflow-y: auto;
        }
        .login-modal-overlay.active .login-modal-content { transform: translateY(0); }
        .modal-drag-handle { width: 40px; height: 5px; background: #E0E0E0; border-radius: 10px; margin: 0 auto 20px auto; }

        /* FOOTER */
        .mobile-footer { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--tech-purple); height: 60px; display: flex; justify-content: space-around; align-items: center; z-index: 500; border-top: 2px solid var(--neon-mint); }
        .nav-item { color: white; text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 2px; font-size: 0.55rem; font-weight: 600; opacity: 0.6; }
        .nav-item.active { color: var(--neon-mint); opacity: 1; }
        .nav-item .material-icons { font-size: 1.2rem; }
    </style>
</head>
<body>

    <div class="header-wrapper">
        <header>
            <div class="brand-logo"><span class="brand-1234">1234</span><span class="brand-farma">Farma</span></div>
            <div class="header-icon-right" onclick="window.location.href='carrinho_mobile.html'">
                <span class="material-icons">shopping_cart</span>
                <span id="cartBadge" class="cart-badge">0</span>
            </div>
        </header>

        <div class="search-bar-wrapper" id="searchArea">
            <div class="search-input">
                <span class="material-icons search-icon-span">search</span>
                <input type="text" id="favSearch" placeholder="Pesquisar nos favoritos..." onkeyup="searchFavs()">
            </div>
        </div>
    </div>

    <main>
        <div id="contentLogged" style="display: none;">
            <h2 class="page-title">Meus Favoritos</h2>
            <div id="favGrid" class="fav-grid"></div>
            
            <div id="emptyState" class="status-container">
                <span class="material-icons">favorite_border</span>
                <h3>Sua lista está vazia</h3>
                <p>Que tal explorar nossos produtos e salvar seus favoritos aqui?</p>
                <a href="loja_mobile.html" class="btn-action">IR PARA A LOJA</a>
            </div>
        </div>

        <div id="notLoggedState" class="status-container">
            <span class="material-icons">lock_person</span>
            <h3>Acesse sua conta</h3>
            <p>Para ver seus medicamentos favoritados, você precisa estar logado no nosso App.</p>
            <button class="btn-action" onclick="openLoginModal()">ENTRAR OU CADASTRAR</button>
        </div>
    </main>

    <div id="loginModal" class="login-modal-overlay" onclick="closeLoginModal()">
        <div class="login-modal-content" onclick="event.stopPropagation()">
            <div class="modal-drag-handle"></div>
            <div id="loginContentArea"></div>
        </div>
    </div>

    <nav class="mobile-footer">
        <a href="loja_mobile.html" class="nav-item"><span class="material-icons">store</span><span>LOJA</span></a>
        <a href="pedidos_mobile.html" class="nav-item"><span class="material-icons">assignment</span><span>PEDIDOS</span></a>
        <a href="ofertas_mobile.html" class="nav-item"><span class="material-icons">local_offer</span><span>OFERTAS</span></a>
        <a href="favoritos_mobile.html" class="nav-item active"><span class="material-icons">favorite</span><span>FAVORITOS</span></a>
        <a href="perfil_mobile.html" class="nav-item"><span class="material-icons">person</span><span>PERFIL</span></a>
    </nav>

    <script>
        // Funções para abrir o Login igual na Loja
        function openLoginModal() {
            fetch('login_mobile.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('loginContentArea').innerHTML = data;
                    document.getElementById('loginModal').classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Verifica o Login
        function checkLogin() {
            const user = sessionStorage.getItem('usuarioFarmaFacil');
            const contentLogged = document.getElementById('contentLogged');
            const notLoggedState = document.getElementById('notLoggedState');
            const searchArea = document.getElementById('searchArea');

            if (user) {
                contentLogged.style.display = 'block';
                notLoggedState.style.display = 'none';
                searchArea.style.visibility = 'visible';
                loadFavoritos();
            } else {
                contentLogged.style.display = 'none';
                notLoggedState.style.display = 'flex';
                searchArea.style.visibility = 'hidden';
            }
        }

        function loadFavoritos() {
            const grid = document.getElementById('favGrid');
            const empty = document.getElementById('emptyState');
            const favs = JSON.parse(localStorage.getItem('favs_mobile')) || [];

            if (favs.length === 0) {
                grid.style.display = 'none';
                empty.style.display = 'flex';
                return;
            }

            grid.style.display = 'grid';
            empty.style.display = 'none';
            grid.innerHTML = '';

            favs.forEach(p => {
                const oldPrice = p.precoLoja || (p.preco * 1.3);
                grid.innerHTML += `
                    <div class="product-card" data-name="${p.nome.toLowerCase()}">
                        <button class="material-icons btn-fav-toggle" onclick="removeFav(${p.id})">favorite</button>
                        <div class="product-img-container">
                            <img src="${p.img}" class="product-img" onerror="this.src='https://placehold.co/120'">
                        </div>
                        <div class="product-info-wrapper">
                            <h3 class="product-title">${p.nome}</h3>
                            <p class="product-lab-info">${p.dose || 'Medicamento'} • ${p.pack || 'unidade'}</p>
                            <div class="price-container">
                                <span class="price-old">R$ ${oldPrice.toFixed(2).replace('.',',')}</span>
                                <span class="product-price">R$ ${p.preco.toFixed(2).replace('.',',')}</span>
                            </div>
                        </div>
                        <button class="btn-add" onclick="addToCart(${p.id}, '${p.nome}', ${p.preco}, '${p.img}', this)">
                            <span class="material-icons">add</span>
                        </button>
                    </div>
                `;
            });
        }

        function removeFav(id) {
            let favs = JSON.parse(localStorage.getItem('favs_mobile')) || [];
            favs = favs.filter(item => item.id !== id);
            localStorage.setItem('favs_mobile', JSON.stringify(favs));
            loadFavoritos();
        }

        function searchFavs() {
            const query = document.getElementById('favSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                const name = card.getAttribute('data-name');
                card.style.display = name.includes(query) ? 'flex' : 'none';
            });
        }

        function addToCart(id, nome, preco, img, btn) {
            let cart = JSON.parse(localStorage.getItem('cart_mobile')) || [];
            const existing = cart.find(item => item.id === id);
            if (existing) existing.qty++; else cart.push({ id, nome, preco, img, qty: 1 });
            localStorage.setItem('cart_mobile', JSON.stringify(cart));
            updateCartBadge();
            btn.classList.add('added');
            btn.innerHTML = '<span class="material-icons">check</span>';
            setTimeout(() => {
                btn.classList.remove('added');
                btn.innerHTML = '<span class="material-icons">add</span>';
            }, 800);
        }

        function updateCartBadge() {
            const cart = JSON.parse(localStorage.getItem('cart_mobile')) || [];
            document.getElementById('cartBadge').innerText = cart.reduce((acc, i) => acc + i.qty, 0);
        }

        window.onload = () => {
            checkLogin();
            updateCartBadge();
        };
    </script>
</body>
</html> 